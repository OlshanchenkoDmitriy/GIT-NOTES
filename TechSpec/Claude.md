## Краткий обзор

Приложение представляет собой **универсальный инструмент для пакетной обработки текста** с возможностью создания и выполнения цепочек трансформаций. Пользователь загружает текстовые данные (файлы, списки строк) и применяет к ним последовательность настраиваемых операций: удаление символов, регулярные выражения, работа с регистром, дедупликация и другие. Каждая операция работает как независимый модуль, который можно включать/выключать, переставлять местами и настраивать отдельно. Результат можно предварительно просмотреть, откатить изменения и сохранить как пресет для повторного использования.

## 1. Понимание задачи

Цель приложения — автоматизировать рутинную обработку текстовых данных через создание гибких, переиспользуемых цепочек трансформаций. Вместо ручного редактирования каждого файла или строки пользователь настраивает последовательность операций один раз, а затем применяет её к любому объёму данных. Приложение должно быть интуитивно понятным для непрограммистов, но достаточно мощным для сложных задач обработки текста.

Ключевая особенность — модульность: каждая операция независима, имеет свои настройки и может быть выполнена отдельно. Это позволяет пошагово отлаживать процесс обработки и создавать библиотеку готовых решений для типовых задач.

## 2. Основные функции (модули обработки)

### Базовые операции:
- **Удаление символов** — настраиваемый список символов для удаления
- **Замена символов** — парные правила замены (старое → новое)
- **Регулярные выражения** — поиск и замена по шаблонам
- **Работа с регистром** — UPPER, lower, Title Case, инверсия
- **Обрезка пробелов** — начало, конец, множественные внутри строк
- **Фильтрация строк** — по длине, содержимому, regex-паттернам
- **Сортировка** — алфавитная, по длине, обратная, случайная
- **Дедупликация** — удаление дубликатов с учётом/без учёта регистра
- **Добавление префиксов/суффиксов** — к каждой строке
- **Нумерация строк** — с настраиваемым форматом
- **Разделение/объединение** — по разделителям, по количеству символов
- **Кодировки** — перекодирование между UTF-8, Windows-1251 и другими

### Дополнительные операции:
- **Извлечение данных** — email, URL, числа, даты по шаблонам
- **Валидация** — проверка формата данных с отчётом об ошибках
- **Статистика** — подсчёт строк, символов, уникальных значений
- **Группировка** — по первым символам, длине, шаблонам

## 3. Архитектурные модули

### Ядро системы:
- **Движок обработки** — выполняет цепочку операций, управляет состоянием
- **Менеджер операций** — регистрация, настройка и выполнение отдельных модулей
- **Система истории** — undo/redo для отката изменений
- **Валидатор данных** — проверка входных параметров и предупреждения

### Хранение и управление:
- **SQLite-адаптер** — сохранение пресетов, настроек, истории
- **JSON-сериализатор** — экспорт/импорт конфигураций
- **Файловый менеджер** — загрузка/сохранение текстовых файлов
- **Менеджер пресетов** — создание, редактирование, организация шаблонов

### Пользовательский интерфейс:
- **Редактор цепочки** — drag&drop для изменения порядка операций
- **Панель настроек** — конфигурация параметров каждой операции
- **Превью-движок** — показ результатов без применения изменений
- **Diff-визуализатор** — сравнение до/после для каждого шага
- **Консоль логов** — отчёты о выполнении и ошибках

## 4. Управление шагами

### Интерфейс редактирования:
- **Список операций** — вертикальный список с чекбоксами вкл/выкл
- **Drag&Drop** — перетаскивание для изменения порядка выполнения
- **Контекстное меню** — дублирование, удаление, отключение операций
- **Панель настроек** — справа от списка, динамически меняется по выбранной операции

### Управление выполнением:
- **Кнопки действий**: "Выполнить всё", "Выполнить до выбранного шага", "Выполнить только выбранный"
- **Пошаговый режим** — выполнение по одной операции с просмотром результата
- **Режим отладки** — подробные логи выполнения каждого шага
- **Точки останова** — приостановка выполнения на конкретных операциях

### Предпросмотр:
- **Live Preview** — автоматическое обновление результата при изменении настроек
- **Diff по шагам** — показ изменений для каждой операции отдельно
- **Статистика изменений** — количество затронутых строк, добавленных/удалённых элементов

## 5. Данные и пресеты

### Структура SQLite:
```
operations_config: id, name, type, parameters_json, position, enabled
presets: id, name, description, operations_list_json, created_date, tags
execution_history: id, preset_id, input_size, output_size, execution_time, errors_json
user_settings: key, value (интерфейс, пути к файлам, последние пресеты)
```

### JSON для экспорта/импорта:
```
{
  "preset_name": "Обработка email-списков",
  "description": "Очистка и валидация списка email адресов",
  "version": "1.0",
  "operations": [
    {
      "type": "trim_spaces",
      "enabled": true,
      "position": 1,
      "parameters": {"start": true, "end": true, "multiple": true}
    },
    {
      "type": "regex_filter",
      "enabled": true,
      "position": 2,
      "parameters": {"pattern": "^[\\w.-]+@[\\w.-]+\\.[a-zA-Z]{2,}$", "action": "keep"}
    }
  ],
  "metadata": {
    "created": "2024-01-15",
    "author": "username",
    "tags": ["email", "validation", "cleanup"]
  }
}
```

## 6. UX-требования

### Основной экран:
- **Три панели**: Входные данные (слева), Цепочка операций (центр), Результат (справа)
- **Табы для данных**: "Текст", "Файл", "Буфер обмена", "История"
- **Статус-бар**: количество строк, размер данных, время выполнения
- **Быстрые действия**: "Очистить", "Отменить", "Применить", "Сохранить"

### Редактор операций:
- **Категории операций** — группировка по типам (текст, фильтры, форматирование)
- **Поиск операций** — быстрый поиск по названию или описанию
- **Шаблоны настроек** — готовые конфигурации для частых задач
- **Валидация ввода** — подсветка ошибок в regex и других параметрах

### Удобство использования:
- **Горячие клавиши** — Ctrl+Z (undo), Ctrl+Y (redo), F5 (выполнить), Ctrl+S (сохранить)
- **Автосохранение** — периодическое сохранение работы в черновики
- **Контекстная помощь** — всплывающие подсказки для каждой операции
- **Темы интерфейса** — светлая/тёмная, настройка шрифтов и размеров

## 7. UX-сценарий работы

### Типичный флоу пользователя:
1. **Загрузка данных** — перетаскивание файла или вставка текста
2. **Выбор пресета** — из библиотеки готовых решений или создание нового
3. **Настройка операций** — добавление/удаление шагов, настройка параметров
4. **Предпросмотр** — проверка результата на части данных
5. **Выполнение** — применение всей цепочки к полному набору данных
6. **Экспорт результата** — сохранение в файл или буфер обмена
7. **Сохранение пресета** — для повторного использования

### Продвинутый сценарий:
1. **Пошаговая отладка** — выполнение операций по одной с анализом
2. **Создание веток** — сравнение разных вариантов обработки
3. **Массовая обработка** — применение пресета к папке файлов
4. **Совместная работа** — экспорт/импорт пресетов между устройствами

## 8. Риски и "узкие места"

### Технические риски:
- **Производительность** — обработка больших файлов (>100MB) может замедлить интерфейс
- **Память** — хранение истории изменений для undo/redo при больших данных
- **Regex-ошибки** — некорректные выражения могут привести к зависанию
- **Кодировки** — потеря данных при неправильном определении кодировки файла

### UX-риски:
- **Сложность** — перегрузка интерфейса опциями может напугать новых пользователей
- **Потеря данных** — случайная перезапись результата без сохранения
- **Неочевидность порядка** — пользователь может не понимать, почему порядок операций важен
- **Производительность UI** — медленный предпросмотр на больших данных

### Способы минимизации:
- **Прогрессивное раскрытие** — базовый режим для новичков, расширенный для опытных
- **Автоматические ограничения** — лимиты на размер предпросмотра, таймауты для regex
- **Умные подсказки** — предупреждения о потенциально опасных операциях
- **Фоновая обработка** — выполнение тяжёлых операций в отдельном потоке
- **Checkpoint-система** — автоматические точки сохранения через определённые интервалы

### Критические моменты для разработчика:
- **Архитектура модулей** — каждая операция должна быть полностью независимой
- **Управление состоянием** — чёткое разделение между настройками, данными и UI-состоянием
- **Обработка ошибок** — graceful degradation при сбоях отдельных операций
- **Тестирование edge cases** — пустые файлы, специальные символы, очень длинные строки


